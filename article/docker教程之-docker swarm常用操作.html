<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>docker教程之-docker swarm常用操作</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="static/css/styles.css"> <!-- 静态文件的链接 -->
    <!-- 引入 highlight.js 的 CSS 样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

</head>
<body>
    <header>
        <div class="navbar container">
            <div class="menu">
                <div class="nav-title"><a href="/index.html">各自花开</a></div>
                <ul class="nav-menu">
                    
                        <li><a href="/index.html">首页</a></li>
                        <li><a href="/categories.html">分类</a>
                        <li><a href="/tags.html">标签</a>






                        <li><a href="webnav.html">网址导航</a></li>
                        <li><a href="https://www.baidu.com" target="_blank">资源分享
                        <!-- 外部链接图标 -->
                        <img src="../static/img/分享_share.png" alt="外部链接" style="position: absolute; top: 0; right: 0; width: 12px; height: 12px;transform: translateX(100%)">
                        </a></li>
                        <li><a href="/search.html">搜索</a></li>
                    
                </ul>
            </div>
        </div>
    </header>
    <div id="app" class="container">

            
            


        <div class="main container">
                
    <div class="content article-content">
        <h3>docker教程之-docker swarm常用操作</h3>
        <div class="tag-container">
        








            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>docker</a>
            </span>
            

        </div>
        
        <div class="container article">
            <p>docker service 命令用来管理docker swarm集群中的服务，该命令只能运行在管理节点上,是docker swarm的命令行工具</p>
<p>docker service 常用命令</p>
<p>创建服务</p>
<!--more-->

<pre class="codehilite"><code class="language-bash">docker service create --name nginx --replicas 2
</code></pre>

<p>更新服务</p>
<pre class="codehilite"><code class="language-bash">#格式
#docker service update --image 镜像地址 $server_name
docker service  update --with-registry-auth --image nginx:1.19.1 nginx
</code></pre>

<p>查看服务</p>
<pre class="codehilite"><code class="language-bash">docker service ls
#搜索某个服务
docker service ps nginx
</code></pre>

<p>扩展伸缩服务，即对服务运行数量进行调整</p>
<pre class="codehilite"><code>docker service scale nginx=4
</code></pre>

<p>删除服务</p>
<pre class="codehilite"><code>docker service rm nginx
</code></pre>

<p>显示详细信息</p>
<pre class="codehilite"><code>docker service inspect nginx
</code></pre>

<p>查看某个服务的日志</p>
<pre class="codehilite"><code>docker service logs nginx
</code></pre>

<p>docker stack常用命令</p>
<p>上面介绍了docker swarm的命令行管理方式，而docker stack命令可以用来通过yaml格式文件创建应用，通常编排好一个yaml格式的文件后，可以通过以下命令创建</p>
<p>通过yaml文件创建更新应用</p>
<pre class="codehilite"><code class="language-bash">docker stack deploy -c docker-stack.yml nginx 
#如果是私有仓库，需要加上参数--with-registry-auth才会下载镜像
docker stack deploy -c docker-stack.yml --with-registry-auth nginx 
</code></pre>

<p>查看swarm集群当前跑了多少个stack(个人理解它类似于k8s里的命名空间)his </p>
<pre class="codehilite"><code>docker stack ls
</code></pre>

<p>列出nginx这个stack中的服务</p>
<pre class="codehilite"><code>docker stack services nginx
</code></pre>

<p>查看nginx这个stack中的任务</p>
<pre class="codehilite"><code>docker stack ps nginx
</code></pre>

<p>删除</p>
<pre class="codehilite"><code>docker stack rm nginx
</code></pre>

<p>移除nginx这个</p>
<pre class="codehilite"><code>docker stack down nginx
</code></pre>

<p>docker-stack.yml样例</p>
<pre class="codehilite"><code class="language-yaml">version:'3.4'
services:
  #服务名
  redis:
    image: redis:4.0.14-alpine
    command: redis-server --appendonly yes --requirepass &quot;123456&quot;
    ports:
      - 8080:80
    volumes:
      - &quot;/data/redis:/data/redis&quot;
    environment:
      APP： test
    deploy:
      #用户可以指定副本数量。默认也是这个值，可以省略
      mode: replicated
      replicas: 2
      #更新策略
      update_config:
        #每组容器更新之间的延迟时间
        delay: 10
      #重启策略
      restart_policy:
        #重启条件
        condition: on-failure
      #根据节点标识绑定节点
      placement:
        constraints: [node.role == manager]
    networks:
      - multihost

networks:
  multihost:
    driver: overlay

volumes:
</code></pre>
        </div>
        
    </div>



                


        </div>

    </div>
    <footer>
        
        <p>&copy; 2024 | 我的博客. 保留所有权利。</p>
    <!--    <p><a href="/privacy">隐私政策</a> | <a href="/terms">使用条款</a></p>-->
        
    </footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
 <!-- 在页面加载完成后启用代码高亮 -->
    <script>
        // 等待页面加载完成后执行高亮
        document.addEventListener('DOMContentLoaded', function() {
            // 启用 highlight.js 代码高亮
            hljs.highlightAll();
        });
    </script>


</html>