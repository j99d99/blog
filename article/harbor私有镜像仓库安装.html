<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>harbor私有镜像仓库安装</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../static/css/styles.css"> <!-- 静态文件的链接 -->
    <!-- 引入 highlight.js 的 CSS 样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

</head>
<body>
    <header>
        <div class="navbar container">
            <div class="menu">
                <div class="nav-title"><a href="/index.html">各自花开</a></div>
                <ul class="nav-menu">
                    
                        <li><a href="/index.html">首页</a></li>
                        <li><a href="/categories.html">分类</a>
                        <li><a href="/tags.html">标签</a>






                        <li><a href="webnav.html">网址导航</a></li>
                        <li><a href="https://www.baidu.com" target="_blank">资源分享
                        <!-- 外部链接图标 -->
                        <img src="../static/img/分享_share.png" alt="外部链接" style="position: absolute; top: 0; right: 0; width: 12px; height: 12px;transform: translateX(100%)">
                        </a></li>
                        <li><a href="/search.html">搜索</a></li>
                    
                </ul>
            </div>
        </div>
    </header>
    <div id="app" class="container">

            
            


        <div class="main container">
                
    <div class="content article-content">
        <h3>harbor私有镜像仓库安装</h3>
        <div class="tag-container">
        








            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>kubernetes</a>
            </span>
            

        </div>
        
        <div class="container article">
            <h5>下载harbor</h5>
<pre class="codehilite"><code class="language-bash">下载链接:       https://github.com/goharbor/harbor/releases
</code></pre>

<h5>自签证书</h5>
<pre class="codehilite"><code class="language-bash">#Getting Certificate Authority
openssl genrsa -out ca.key 4096
openssl req -x509 -new -nodes -sha512 -days 3650 \
    -subj &quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=register/OU=Personal/CN=registry.k8s.com&quot; \
    -key ca.key \
    -out ca.crt

#Getting Server Certificate
openssl genrsa -out registry.k8s.com.key 4096
openssl req -sha512 -new \
    -subj &quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=register/OU=Personal/CN=registry.k8s.com&quot; \
    -key registry.k8s.com.key \
    -out registry.k8s.com.csr

cat &gt; v3.ext &lt;&lt;-EOF
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth 
subjectAltName = @alt_names

[alt_names]
DNS.1=registry.k8s.com
DNS.2=registry.k8s
DNS.3=localhost.localdomain
EOF

openssl x509 -req -sha512 -days 3650 \
    -extfile v3.ext \
    -CA ca.crt -CAkey ca.key -CAcreateserial \
    -in registry.k8s.com.csr \
    -out registry.k8s.com.crt
</code></pre>

<h5>安装harbor</h5>
<h6>下载docker-compose</h6>
<pre class="codehilite"><code class="language-bash">curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
</code></pre>

<h6>解压harbor</h6>
<pre class="codehilite"><code class="language-bash">tar xvf harbor-offline-installer-v1.8.2.tgz
</code></pre>

<h6>配置harbor</h6>
<pre class="codehilite"><code class="language-bash">vim harbor.yml
hostname: register.k8s.com
https:
  port: 443
  certificate: ./ssl/registry.k8s.com.crt
  private_key: ./ssl/registry.k8s.com.key  
harbor_admin_password: youpassword
</code></pre>

<h6>安装</h6>
<pre class="codehilite"><code class="language-bash">sh install.sh
</code></pre>

<h6>harbor服务管理</h6>
<p>查看</p>
<pre class="codehilite"><code class="language-bash">docker-compose ps
</code></pre>

<p>关闭</p>
<pre class="codehilite"><code class="language-bash">docker-compose stop
</code></pre>

<p>启动</p>
<pre class="codehilite"><code class="language-bash">docker-compose start
</code></pre>

<p>修改配置重新生效</p>
<pre class="codehilite"><code class="language-bash">docker-compose down -v
vim harbor.yml
prepare --with-notary --with-clair --with-chartmuseum   参数可选
docker-compose up -d
</code></pre>

<p>公钥拷贝到客户端</p>
<pre class="codehilite"><code class="language-bash">mkdir /etc/docker/certs.d/register.k8s.com -p
scp registry.k8s.com.crt root@172.16.88.xx:/etc/docker/certs.d/registry.k8s.com/
</code></pre>

<p>通过浏览器创建项目后即可使用,例创建test项目</p>
<pre class="codehilite"><code class="language-bash">docker login register.k8s.com
username:
password:
docker tag SOURCE_IMAGE[:TAG] register.k8s.com/test/IMAGE[:TAG]
docker push register.k8s.com/test/IMAGE[:TAG]
</code></pre>
        </div>
        
    </div>



                


        </div>

    </div>
    <footer>
        
        <p>&copy; 2024 | 我的博客. 保留所有权利。</p>
    <!--    <p><a href="/privacy">隐私政策</a> | <a href="/terms">使用条款</a></p>-->
        
    </footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
 <!-- 在页面加载完成后启用代码高亮 -->
    <script>
        // 等待页面加载完成后执行高亮
        document.addEventListener('DOMContentLoaded', function() {
            // 启用 highlight.js 代码高亮
            hljs.highlightAll();
        });
    </script>


</html>