<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>inotify-tools实时监控文件夹或文件变化</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../static/css/styles.css"> <!-- 静态文件的链接 -->
    <!-- 引入 highlight.js 的 CSS 样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

</head>
<body>
    <header>
        <div class="navbar container">
            <div class="menu">
                <div class="nav-title"><a href="/index.html">各自花开</a></div>
                <ul class="nav-menu">
                    
                        <li><a href="/index.html">首页</a></li>
                        <li><a href="/categories.html">分类</a>
                        <li><a href="/tags.html">标签</a>






                        <li><a href="webnav.html">网址导航</a></li>
                        <li><a href="https://www.baidu.com" target="_blank">资源分享
                        <!-- 外部链接图标 -->
                        <img src="../static/img/分享_share.png" alt="外部链接" style="position: absolute; top: 0; right: 0; width: 12px; height: 12px;transform: translateX(100%)">
                        </a></li>
                        <li><a href="/search.html">搜索</a></li>
                    
                </ul>
            </div>
        </div>
    </header>
    <div id="app" class="container">

            
            


        <div class="main container">
                
    <div class="content article-content">
        <h3>inotify-tools实时监控文件夹或文件变化</h3>
        <div class="tag-container">
        








            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>shell</a>
            </span>
            

        </div>
        
        <div class="container article">
            <h2>安装inotify-tools</h2>
<pre class="codehilite"><code class="language-bash">yum install -y inotify-tools
</code></pre>

<h2>编写监控脚本</h2>
<ul>
<li>监测到变化后需要执行的脚本
<strong>以文件变化自动提交gitlab为例</strong></li>
</ul>
<pre class="codehilite"><code class="language-bash">vim auto-commit-git.sh
#!/bin/bash

DATE=`date +%Y-%m-%d`
FILE_HOME=/data/www/kode/data/User/root/home/note/
cd ${FILE_HOME} &amp;&amp; git add . &amp;&amp; git commit -m &quot;${DATE}&quot;;git push http://root:xxx@gitlab.xxx.com/root/note.git master
</code></pre>

<ul>
<li>编写循环监控脚本</li>
</ul>
<pre class="codehilite"><code class="language-bash">vim monitor_note.sh
#!/bin/sh

# 监视的文件或目录
filename=/data/www/kode/data/User/root/home/note

# 监视发现有增、删、改时执行的脚本
script=/data/entrypoint/scripts/auto-commit-git.sh

inotifywait -mrq --format '%e' --event create,delete,modify  $filename | while read event
  do
      case $event in MODIFY|CREATE|DELETE) bash $script ;;
      esac
  done
</code></pre>

<ul>
<li>运行脚本监控目录</li>
</ul>
<pre class="codehilite"><code class="language-bash">chmod +x auto-commit-git.sh
chmod +x monitor_note.sh
nohup sh monitor_note.sh &gt;/tmp/inotify.log 2&gt;&amp;1
</code></pre>

<h2>inotify-tools选项解析</h2>
<pre class="codehilite"><code class="language-bash">@&lt;file&gt;     #排除不需要监视的文件，可以指定相对路径或绝对路径
--fromfile &lt;file&gt;   #从文件读取需要监视的文件或排除的文件，一个文件一行，排除的文件以@开头
-m|--monitor    #收到单个事件不退出，一直监视，默认：收到单个事件后立即退出
-d|--daemon     #跟--monitor一样，除了是在后台运行，需要指定--outfile把事情输出到一个文件。也意味着使用了--syslog
-o|--outfile &lt;file&gt;     #输出事件到&lt;file&gt;而不是stdout
-s|--syslog             #输出错误信息到syslog而不是stderr
-r|--recursive          #监控目录下所有子目录，创建新的子目录也会被监控
-q|--quiet              #不输出详细信息
--exclude &lt;pattern&gt;         #不处理正则表达式匹配到的文件的任何事件，大小写敏感
--excludei &lt;pattern&gt;        #不处理正则表达式匹配到的文件的任何事件，大小写敏感
 -t &lt;seconds&gt;, --timeout &lt;seconds&gt;      #设置超时时间，如果为0，则一直等待事件
 -e &lt;event&gt;, --event &lt;event&gt;        #指定监听的事件，可以多次指定，如果省略，则监听所有事件
 -c, --csv      #输出为csv格式
 --timefmt &lt;fmt&gt;        #指定时间格式，用于--format选项中的%T格式
 --format &lt;fmt&gt; 指定输出格式
     %w 表示发生事件的目录
     %f 表示发生事件的文件
     %e 表示发生的事件
     %Xe 事件以“X”分隔
     %T 使用由--timefmt定义的时间格式
</code></pre>

<h2>inotify-tools事件选项解析</h2>
<p>inotify-tools事件选项<code>--event</code>可以监听的事件如下</p>
<pre class="codehilite"><code class="language-bash">access 读取文件或目录

modify 写文件或目录

attrib 更改文件或目录属性

close_write 文件在写后关闭

close_nowrite 文件在只读模式下被读后关闭

close  文件或目录被关闭

open   文件或目录被打开

moved_from  文件或者目录移出监视目录

moved_from  文件或目录从监视目录移出

move 文件或目录移动

create 创建文件或目录

delete 删除文件或目录

delete_self 删除后不再监听此文件或目录

unmount 文件系统取消挂载，此后不在监听该文件系统
</code></pre>
        </div>
        
    </div>



                


        </div>

    </div>
    <footer>
        
        <p>&copy; 2024 | 我的博客. 保留所有权利。</p>
    <!--    <p><a href="/privacy">隐私政策</a> | <a href="/terms">使用条款</a></p>-->
        
    </footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
 <!-- 在页面加载完成后启用代码高亮 -->
    <script>
        // 等待页面加载完成后执行高亮
        document.addEventListener('DOMContentLoaded', function() {
            // 启用 highlight.js 代码高亮
            hljs.highlightAll();
        });
    </script>


</html>