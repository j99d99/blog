<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nginx源码安装</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../static/css/styles.css"> <!-- 静态文件的链接 -->
    <!-- 引入 highlight.js 的 CSS 样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

</head>
<body>
    <header>
        <div class="navbar container">
            <div class="menu">
                <div class="nav-title"><a href="/index.html">各自花开</a></div>
                <ul class="nav-menu">
                    
                        <li><a href="/index.html">首页</a></li>
                        <li><a href="/categories.html">分类</a>
                        <li><a href="/tags.html">标签</a>






                        <li><a href="webnav.html">网址导航</a></li>
                        <li><a href="https://www.baidu.com" target="_blank">资源分享
                        <!-- 外部链接图标 -->
                        <img src="../static/img/分享_share.png" alt="外部链接" style="position: absolute; top: 0; right: 0; width: 12px; height: 12px;transform: translateX(100%)">
                        </a></li>
                        <li><a href="/search.html">搜索</a></li>
                    
                </ul>
            </div>
        </div>
    </header>
    <div id="app" class="container">

            
            


        <div class="main container">
                
    <div class="content article-content">
        <h3>nginx源码安装</h3>
        <div class="tag-container">
        








            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>linux</a>
            </span>
            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>nginx</a>
            </span>
            

        </div>
        
        <div class="container article">
            <h2>nginx的官网下载</h2>
<p>到nginx的官方下载站点<code>http://nginx.org/en/download.html</code>下载想要安装的nginx版本</p>
<pre class="codehilite"><code class="language-bash">wget http://nginx.org/download/nginx-1.16.1.tar.gz
</code></pre>

<!--more-->
<h2>安装ngninx</h2>
<h3>解压下载文件</h3>
<pre class="codehilite"><code class="language-bash">tar zxvf nginx-1.16.1.tar.gz
</code></pre>

<h3>隐藏server信息(可选)</h3>
<pre class="codehilite"><code class="language-bash">vi src/http/ngx_http_header_filter_module.c ## 49-50行

内容：
static char ngx_http_server_string[] = &quot;Server: nginx&quot; CRLF;
static char ngx_http_server_full_string[] = &quot;Server: &quot; NGINX_VER CRLF;

更改为：
static char ngx_http_server_string[] = &quot;Server: web-server&quot; CRLF;
static char ngx_http_server_full_string[] = &quot;Server:web-server &quot; CRLF;
</code></pre>

<p>当然如果只是隐藏nginx的版本号可以在nginx.conf配置</p>
<pre class="codehilite"><code class="language-bash">server_tokens off
</code></pre>

<h3>进入解压目录执行编译安装</h3>
<pre class="codehilite"><code class="language-bash">cd nginx-1.16.1

#编译
./configure --prefix=/usr/local/nginx \
--conf-path=/etc/nginx/nginx.conf \
--modules-path=/etc/nginx/ \
--sbin-path=/usr/sbin/nginx \
--user=nginx --group=nginx \
--with-http_ssl_module \
--with-http_realip_module \
--with-http_addition_module \
--with-http_image_filter_module \
--with-http_sub_module \
--with-http_dav_module \
--with-http_flv_module \
--with-http_mp4_module \
--with-http_gzip_static_module \
--with-http_random_index_module \
--with-http_secure_link_module \
--with-http_degradation_module \
--with-http_stub_status_module \
--with-debug \
--with-http_realip_module \
--with-stream \
--with-stream_ssl_preread_module

#安装
make
make install
</code></pre>

<h2>配置优化nginx.conf</h2>
<p>默认的nginx.conf文件很简单，许多参数需要自己配置，下面附上一个工作中长用的配置文件</p>
<p>```wp-block-preformatted bash
user  www  www;
worker_processes  auto;
worker_cpu_affinity  auto;
worker_rlimit_nofile    65536;
pid/var/run/nginx.pid;
events
{
useepoll;
worker_connections65536;
}
http
{
    includemime.types;
    default_typeapplication/octet-stream;
    charset  utf-8;</p>
<pre class="codehilite"><code>server_names_hash_bucket_size 128;
client_header_buffer_size 4k;
large_client_header_buffers 4 32k;
client_max_body_size 8m;

open_file_cache max=65536 inactive=20s;
open_file_cache_valid 30s;
open_file_cache_min_uses 1;

sendfile on;
tcp_nopush on;
keepalive_timeout 60;
tcp_nodelay on;
server_tokens off;
port_in_redirect off;

#fastcgi
fastcgi_connect_timeout300;
fastcgi_send_timeout 300;
fastcgi_read_timeout 300;
fastcgi_buffer_size 64k;
fastcgi_buffers4 64k;
fastcgi_busy_buffers_size 128k;
fastcgi_temp_file_write_size 128k;

#open gzip
gzip on;
gzip_vary on;
gzip_min_length1k;
gzip_buffers 4 16k;
gzip_http_version 1.0;
gzip_comp_level2;
gzip_typestext/plainapplication/x-javascript text/css application/xml;
gzip_disable &quot;MSIE \[1-6\]\\.(?!.*SV1)&quot;;

#Proxy
proxy_connect_timeout600;
proxy_read_timeout600;
proxy_send_timeout600;
proxy_buffer_size16k;
proxy_buffers432k;
proxy_busy_buffers_size64k;
proxy_temp_file_write_size64k;

#Log format
log_format  access  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
              '$status $body_bytes_sent &quot;$http_referer&quot; '
              '&quot;$http_user_agent&quot; $http_x_forwarded_for';
</code></pre>

<p>server
    {
        listen 80 default;
        server_name _;
        return 403;
    }
    include vhosts/*.conf;
}
```</p>
        </div>
        
    </div>



                


        </div>

    </div>
    <footer>
        
        <p>&copy; 2024 | 我的博客. 保留所有权利。</p>
    <!--    <p><a href="/privacy">隐私政策</a> | <a href="/terms">使用条款</a></p>-->
        
    </footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
 <!-- 在页面加载完成后启用代码高亮 -->
    <script>
        // 等待页面加载完成后执行高亮
        document.addEventListener('DOMContentLoaded', function() {
            // 启用 highlight.js 代码高亮
            hljs.highlightAll();
        });
    </script>


</html>