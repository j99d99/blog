<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>批量管理工具ansible使用</title>
    <link rel="icon" href="../static/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../static/css/styles.css"> <!-- 静态文件的链接 -->
    <!-- 引入 highlight.js 的 CSS 样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

</head>
<body>
    <header>
        <div class="navbar container">
            <div class="menu">
                <div class="nav-title"><a href="/index.html">各自花开</a></div>
                <ul class="nav-menu">
                    
                        <li><a href="/index.html">首页</a></li>
                        <li><a href="/categories.html">分类</a>
                        <li><a href="/tags.html">标签</a>






                        <li><a href="webnav.html">网址导航</a></li>
                        <li><a href="https://www.baidu.com" target="_blank">资源分享
                        <!-- 外部链接图标 -->
                        <img src="../static/img/分享_share.png" alt="外部链接" style="position: absolute; top: 0; right: 0; width: 12px; height: 12px;transform: translateX(100%)">
                        </a></li>
                        <li><a href="/search.html">搜索</a></li>
                    
                </ul>
            </div>
        </div>
    </header>
    <div id="app" class="container">

            
            


        <div class="main container">
                
    <div class="content article-content">
        <h3>批量管理工具ansible使用</h3>
        <div class="tag-container">
        








            
                <span>
                <img src="../static/img/标签_tag-one.png" class="img-icon">
                <a>linux</a>
            </span>
            

        </div>
        
        <div class="container article">
            <h3>ansible的安装</h3>
<p>yum安装方式</p>
<pre class="codehilite"><code class="language-bash">yum install -y epel-release
yum install -y ansible
</code></pre>

<p>pip的安装方式</p>
<pre class="codehilite"><code class="language-bash">pip install ansible -i https://mirrors.aliyun.com/pypi/simple/
</code></pre>

<h3>ansible定义管理节点(资产)和变量</h3>
<p>一、 简单使用介绍
1. ansible管理被管理节点，如果不想设置被管理节点的登录信息，可以配置免秘钥登录</p>
<pre class="codehilite"><code class="language-bash">ssh-keygen -t rsa -b 2048 -N '' -f ~/.ssh/id_rsa

# 将公钥分发到被管理节点
ssh-copy-id $IPs
</code></pre>

<ol>
<li>基础使用</li>
</ol>
<pre class="codehilite"><code class="language-bash"># 单节点列表，注意节点后面的逗号
ansible all -i 172.16.88.112, -m ping
ansible all -i 172.16.88.112,172.16.88.113 -m ping

#定义了节点信息的hosts文件
ansible all -i ./hosts -m ping
</code></pre>

<p><strong>注意：</strong></p>
<ul>
<li><code>all</code> 节点选择器，通常<code>-i</code>参数给定节点信息，<code>all</code>表示匹配所有的<code>-i</code>指定的节点，也可以是文本内定义的某个分组名</li>
<li><code>-i</code>参数指定节点列表，可以是一个列表，也可以是一个文件名，如果是一个单节点列表，后面需要加上逗号<code>,</code>否则执行会报错，如果没有指定<code>-i</code>参数则使用默认文件<code>/etc/ansible/hosts</code></li>
<li><code>-m</code> 执行运行的模块</li>
<li><code>-a</code> 指定模块参数</li>
</ul>
<p>二、 静态资产
    静态资产就是一个文本文件，定义资产信息，默认是<code>/etc/ansible/hosts</code>,定义的节点可以是主机名或者主机IP，对不同功能节点服务器可以定义不同的分组，分组名用<code>[]</code>括起，有利于后续操作时方便节点选择</p>
<ol>
<li>资产定义和分组</li>
</ol>
<pre class="codehilite"><code class="language-bash">vim test_hosts

# 定义web组的资产
[web]
172.16.88.112
172.16.88.11[5:9]   #表示115到119的ip段

# 定义db组的资产
[db]
172.16.88.113

# 将web组合db组的资产都嵌套到all
[all_hosts]
[all_hosts:children]  #:children是固定写法
web
db
</code></pre>

<ol>
<li>列出定义的资产</li>
</ol>
<pre class="codehilite"><code class="language-bash"># 列出所有资产
ansible all -i test_hosts --list-hosts

# 列出单个资产
ansible 172.16.88.113 -i test_hosts --list-hosts

# 使用*匹配
ansible 172.16.88.* -i test_hosts --list-hosts

# 并集
ansible 'web:db' -i test_hosts --list-hosts

# 交集
ansible 'web:&amp;db' -i test_hosts --list-hosts

# 排除，哪个分组在前，以哪个分组为基准
ansible 'web:!db' -i test_hosts --list-hosts

# 列出db分组所有资产
ansible db -i test_hosts --list-hosts

# 列出all_hosts组的资产
ansible all_hosts -i test_hosts --list-hosts
</code></pre>

<p>三、 动态资产
待补充...</p>
<h4>全局变量</h4>
<p>执行ansible或者ansible-playbook时通过<code>-e</code>参数指定的变量
传递形式
1. 普通key=value形式传递</p>
<pre class="codehilite"><code class="language-bash">ansible  web -i test_hosts  -m  template -a &quot;src=./test.j2 dest=/tmp/test&quot; -e &quot;var=world&quot;
</code></pre>

<ol>
<li>以yaml/json格式或者文本传递</li>
</ol>
<pre class="codehilite"><code class="language-yml"># json格式
cat a.json
{&quot;var&quot;:&quot;word&quot;}
ansible  web -i test_hosts  -m  debug -a &quot;msg='this is a hello {{ var }}'&quot; -e @a.json

## yaml格式
cat a.yaml
var: word

ansible  web -i test_hosts  -m  debug -a &quot;msg='this is a hello {{ var }}'&quot; -e @a.yaml
</code></pre>

<h4>剧本变量</h4>
<p>这种变量和playbook有关，常见的两种定义方式</p>
<ol>
<li>通过playbook的vars属性定义</li>
</ol>
<pre class="codehilite"><code class="language-bash"># 通过vars定义
- name: test playbook
  hosts: all
  vars:
    user: haha
    path: /home/data
</code></pre>

<ol>
<li>通过playbook的vars_files指定一个变量文件，变量文件也是yaml格式文件</li>
</ol>
<pre class="codehilite"><code class="language-bash"># 定义变量文件vars_file.yaml
user: haha
path: /home/data

# 指定vars_files
- name: test playbook
  hosts: all
  vars_files:
    - vars_file.yaml
</code></pre>

<ol>
<li>playbook中使用剧本变量
直接使用双大括号将变量名括起来</li>
</ol>
<pre class="codehilite"><code class="language-bash">- name: test playbook
  hosts: all
  vars:
    user: haha
    path: /home/data
  tasks:
    - name: tasks test {{ user }}
      user:
          # 这里需要注意字典引用变量需要加上双引号，否则会报错，区别于上面的字符串引用变量
        name: &quot;{{ user }}&quot;
        paths: &quot;{{ path }}&quot;
</code></pre>

<h4>资产变量</h4>
<p>前面我们介绍了资产的定义，如果要为某台服务器定义单独的变量，叫做资产变量，直接在资产的后面定义变量即可，多个以空格隔开</p>
<ol>
<li>主机变量
比如我们给前面定义的资产添加资产变量</li>
</ol>
<pre class="codehilite"><code class="language-bash">vim test_hosts

# 定义web组的资产
[web]
172.16.88.112 port=22
...


# 资产变量的引用
ansible  web -i test_hosts  -m  debug -a &quot;msg='port is {{ port }}'&quot;
</code></pre>

<ol>
<li>主机组变量</li>
</ol>
<pre class="codehilite"><code class="language-bash">vim test_hosts

# 定义web组的资产
[web]
172.16.88.112
172.16.88.11[5:9]   #表示115到119的ip段

# 定义web组的组变量[:vars]是固定写法
[web:vars]
port=22
...
</code></pre>

<p><strong>注意:</strong>
当主机定义了主机变量和主机组变量的时候，主机变量优先级大于主机组变量优先级
3. 主机变量的继承</p>
<pre class="codehilite"><code class="language-bash">vim test_hosts
...
[all_hosts]
[all_hosts:children]  #:children是固定写法
web
db

#定义主机变量的继承
[all_hosts:vars]
port=33
</code></pre>

<h4>Inventory内置变量</h4>
<p>内置变量都是以<code>ansible_</code>为前缀的
ansible_ssh_host    连接远程主机的主机名或IP
ansible_ssh_port    端口
ansible_ssh_user    用户
ansible_ssh_pass    密码，不安全，官方建议使用密钥或者--ask-pass
ansible_sudo_pass   sudo密码，不安全，官方建议--ask-sudo-pass
ansible_ssh_private_key_file ssh使用的私钥文件
ansible_python_interpreter  目标主机的python路径，使用当远程主机有多个python环境需要指定具体环境时使用</p>
<h4>Facts变量</h4>
<p>ansible内置变量，完全由setup模块去搜集完成，收集远程主机的各种信息
Facts变量的使用
1. 命令行使用</p>
<pre class="codehilite"><code class="language-bash"># 获取完整变量
ansible  web -i test_hosts  -m  setup

#过滤变量，filter模糊匹配
ansible  web -i test_hosts  -m  setup -a &quot;filter=*default_ipv4*&quot;
</code></pre>

<ol>
<li>playbook使用
playbook会自动获取Facts变量，直接使用即可
如需关闭，在playbook中添加参数</li>
</ol>
<pre class="codehilite"><code class="language-bash">gather_facts: no
</code></pre>

<h4>变量优先级</h4>
<p><strong>优先级从高到低</strong>
全局变量(-e指定参数)
playbook剧本变量(vars定义的变量)
资产变量</p>
<h3>常用模块</h3>
<h4>学会使用帮助命令</h4>
<pre class="codehilite"><code class="language-bash"># 列出模块
ansible-doc -l

# 列出某个模板的使用方法
ansible-doc module_name     #详细
ansible-doc -s module_name  # 简洁
</code></pre>

<h4>command模块</h4>
<p>command模块是ansible的默认模块，不指定<code>-m</code>参数是使用的就是command模块</p>
<pre class="codehilite"><code class="language-bash">ansible db -i test_hosts -a &quot;ip a&quot;
ansible db -i test_hosts -m command -a &quot;ip a&quot;
</code></pre>

<h4>shell模块</h4>
<pre class="codehilite"><code class="language-bash">ansible -i test_hosts web -m shell -a &quot;ps -ef|grep etcd&quot;
</code></pre>

<p><strong>shell模块和command模块的区别</strong>
command模块无法执行shell的内置命令和特性，比如管道等，shell模块可以</p>
<h4>script模块</h4>
<p>使管理节点上的脚本在远程被管理节点上执行</p>
<p>在管理节点新建一个测试脚本然后通过ansible执行</p>
<pre class="codehilite"><code class="language-bash">echo 'ip a' &gt; /tmp/test.sh
ansible web -i test_hosts  -m script -a &quot;/tmp/test.sh&quot;
</code></pre>

<h4>copy模块和fetch模块</h4>
<p>copy模块用户管理节点和被管理节点之间的文件拷贝，用于将管理节点文件拷贝到被管理节点
fetch模块与copy模块功能相反，将被管理节点的文件拷贝到管理节点上</p>
<p>copy常用参数解析:
|参数|解释|
| --- | --- |
| src | 指定拷贝文件的源地址 |
| dest | 指定拷贝文件的目标地址 |
| backup | 拷贝文件时若原始文件发生变化则对目标文件进行备份 |
| woner | 指定新拷贝文件的所有者 |
| group | 指定新拷贝文件的属组 |
| mode | 指定新拷贝文件的权限 |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash">ansible web -i test_hosts  -m copy -a &quot;src=./test.sh dest=/root/ backup=yes mode=755&quot;
</code></pre>

<p>fetch常用参数解析
|参数|解释|
| --- | --- |
| src | 指定远程主机上需要拷贝文件的地址 |
| dest | 指定拷贝文件到本地的地址 |
| flat | 允许覆盖 |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash">ansible web -i test_hosts  -m fetch -a &quot;src=/home/testans/.ssh dest=/tmp&quot;
</code></pre>

<h4>package模块</h4>
<p>用于包管理
|参数|解释|
| --- | --- |
| name | 要安装的软件包名，多个以逗号<code>,</code>隔开 |
| state | 对当前指定的软件的操作,安装(present)/删除(absent) |
| use | 使用哪种包管理，yum/apt等，默认auto |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash"># 安装nginx
ansible web -i test_hosts  -m package -a &quot;name=nginx state=present&quot;

# 移除nginx
ansible web -i test_hosts  -m package -a &quot;name=nginx state=absent&quot;
</code></pre>

<h4>yum模块</h4>
<p>在被管理节点上执行yum命令
|参数|解释|
| --- | --- |
| name | 要安装的软件包名，多个以逗号<code>,</code>隔开 |
| state | 对当前指定的软件的操作 |</p>
<p>state状态的支持的参数
|参数|解释|
| --- | --- |
| present | 确保安装，但不升级 |
| installed | 确保已经安装 |
| latest | 确保安装且升级到最新 |
| absent | 确认删除 |
| removed | 确认删除 |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash"># 安装nginx
ansible web -i test_hosts  -m yum -a &quot;name=nginx state=present&quot;
ansible web -i test_hosts  -m yum -a &quot;name=nginx state=installed&quot;
ansible web -i test_hosts  -m yum -a &quot;name=nginx state=latest&quot;

# 移除nginx
ansible web -i test_hosts  -m yum -a &quot;name=nginx state=absent&quot;
ansible web -i test_hosts  -m yum -a &quot;name=nginx state=removed&quot;

# 安装软件包组,软件包组以@开头
ansible web -i test_hosts  -m yum -a &quot;name='@Development tools' state=present&quot;
</code></pre>

<h4>systemd和service模块</h4>
<p>centos6管理服务使用的是service模块，centos7以后使用的是systemd模块</p>
<ol>
<li>service模块的用法</li>
</ol>
<p>参数|解释|
| --- | --- |
| name | 服务名称 |
| enabled | 是否开机自启动,yes或者no |
| pattern | 定义一个模式，如果通过status指令来查看服务的状态时，没有响应，就会通过ps指令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然在运行 |
| state | 执行的操作,启动(started)、停止(stopped)、重启(restarted)、重新加载(reloaded) |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash"># 启动nginx并设置开机自启
ansible web -i test_hosts  -m service -a &quot;name=nginx state=started enabled=yes&quot;

# 关闭nginx
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=stopped&quot;

# 重启nginx
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=restarted&quot;
</code></pre>

<ol>
<li>systemd模块的用法</li>
</ol>
<p>|参数|解释|
| --- | --- |
| daemon_reload | 重新载入systemd |
| name | 服务名称 |
| enabled | 是否开机自启动,yes或者no |
| state | 执行的操作,启动(started)、停止(stopped)、重启(restarted)、重新加载(reloaded) |
<strong>注意:</strong>
state参数的<code>reloaded</code>状态需要服务自身支持reload才能使用，比如nginx就支持</p>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 重新加载systemd，等价于systemd daemon_reload
ansible web -i test_hosts  -m systemd -a &quot;daemon_reload=yes&quot;

# 启动nginx并设置开机自启
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=started enabled=yes&quot;

# 关闭nginx
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=stopped&quot;

# 重启nginx
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=restarted&quot;

# 重新加载nginx
ansible web -i test_hosts  -m systemd -a &quot;name=nginx state=reloaded&quot;
</code></pre>

<h4>group和user模块</h4>
<ol>
<li>group模块使用</li>
<li>|参数|解释|
| --- | --- |
| system | 是否为系统组，yes或no,默认no |
| name | 组名 |
| state | 创建(present)和删除(absent),默认present |</li>
</ol>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 创建普通用户组group01
ansible web -i test_hosts  -m  group -a &quot;name=group01&quot;
</code></pre>

<ol>
<li>user模块使用</li>
</ol>
<p>|参数|解释|
| --- | --- |
| name | 用户名 |
| group | 设置用户的主组 |
| groups | 将用户加入其它组，多个组以逗号隔开 |
| append | 与groups配合使用的参数，设置为yes的时候，不会把用户从其他已经加入的组中删除 |
| password | 用户密码，接收加密后的值，默认不设置密码 |
| update_password | 设置的密码不同于原始密码，则更新密码 |
| home | 指定用户家目录 |
| shell | 设置用户shell |
| commnet | 描述信息 |
| create_home | 创建用户时是否创建家目录，默认yes |
| system | 设置为yes时将创建为一个系统账号 |
| expires | 设置用户过期时间，值为时间戳 |
| generate_ssh_key | 设置为yes时为用户创建密钥，不会覆盖原有密钥 |
| ssh_key_type | 设置密钥类型，默认rsa |
| state | 添加用户(present)/删除用户(absent) |
| remove | 与state参数一起使用，删除一个用户管理的目录，比如家目录等 |</p>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 创建用户名设置密码
pass=$(echo &quot;123456&quot; |openssl passwd -1 -stdin)
ansible  web -i test_hosts  -m  user -a &quot;name=testuser password=${pass}&quot;

# 创建用户并创建密钥对，密钥对类型为ecdsa
ansible  web -i test_hosts  -m  user -a &quot;name=testuser generate_ssh_key=yes ssh_key_type=ecdsa&quot;

# 创建用户并设置有效期到某一天，并将改用户加入到某个组
ansible  web -i test_hosts  -m  user -a &quot;name=testuser expires=$(date +%s -d 20210827) groups=docker&quot;

# 创建用户并设置有效期到某一天，并将改用户加入到某个组，不改变原有组
ansible  web -i test_hosts  -m  user -a &quot;name=testuser expires=$(date +%s -d 20210827) groups=docker append=yes&quot;
</code></pre>

<h4>file模块</h4>
<p>|参数|解释|
| --- | --- |
| path | 指定文件路径或目录 |
| owner | 属主 |
| group | 属组 |
| mode | 权限 |
| state | file/directory/link/hard/touch/absent |
| recurse | 递归设置文件属性，只对目录有效 |
| src | 当state=link时可指定该参数，表示被链接的源文件路径 |
| dest | 当state=link时可指定该参数，被链接的路径 |</p>
<p>state参数解析
|参数|解释|
| --- | --- |
| directory | 目录不存在则创建 |
| file | 文件不存在则不会被创建，存在则返回文件信息 |
| link | 创建软链接 |
| hard | 创建硬链接 |
| touch | 如果文件不存在，则创建一个新文件，如果存在则更新最后修改时间 |
| absent | 删除目录、文件或取消链接 |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash"># 创建文件
ansible  web -i test_hosts  -m  file &quot;path=/tmp/test.log state=touch&quot;

# 创建软链接
ansible  web -i test_hosts  -m  file &quot;state=link src=/usr/bin/vi dest=/tmp/vim&quot;

# 取消软链接
ansible  web -i test_hosts  -m  file -a &quot;path=/tmp/vim state=absent&quot;
</code></pre>

<h4>cron模块</h4>
<p>cron模块创建的计划任务是不可以使用<code>crontab -e</code>命令去编辑，否则ansible无法在控制该任务</p>
<p>|参数|解释|
| --- | --- |
| name | 任务名 |
| minute | 分钟，格式(0-59,<em>,</em>/2)等，默认<em> |
| hour | 小时，格式(0-23,</em>,<em>/2)等，默认</em> |
| day | 天，格式(1-31,<em>,</em>/2)等，默认<em> |
| month | 月，格式(1-12,</em>,<em>/2)等，默认</em> |
| weekday | 星期，格式(0-6,Sunday-Saturday,1,<em>)等，默认</em> |
| job | 执行的任务 |
| state | 新增(present),删除(absent) |</p>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 创建一个每2分钟执行一次的计划任务
ansible  web -i test_hosts  -m  cron -a &quot;name=testcron minute='*/2' job='ls /tmp' &quot;

# 删除计划任务testcron
ansible  web -i test_hosts  -m  cron -a &quot;name=testcron state=absent&quot;
</code></pre>

<h4>debug模块</h4>
<p>debug模块主要用来调试，打印变量结果等</p>
<p>|参数|解释|
| --- | --- |
| var | 打印指定变量的值 |
| msg | 打印一段可以格式化的字符串 |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-yml"># 打印role变量的值，-e指定一个变量role
ansible  web -i test_hosts  -m  debug -a &quot;var=role&quot; -e &quot;role=test&quot;

# 打印一串带变量的字符串,变量使用{{ xx }}括起
ansible  web -i test_hosts  -m  debug -a &quot;msg='this is a {{ role }}'&quot; -e &quot;role=test&quot;
</code></pre>

<h4>template模块</h4>
<p>使用Jinjia2格式作为文件模板，用法和copy模块基本一样，差别是模板文件内存在变量替换</p>
<p>|参数|解释|
| --- | --- |
| src | 指定模板文件路径 |
| dest | 指定被管理节点生成文件路径 |
| owner | 属主 |
| group | 属组 |
| mode | 权限 |
| backup | 创建一个包含时间戳的备份文件，yes/no |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-yml"># 创建一个模板文件
vi test.j2
Hello {{ var }}

# 根据模板文件和传入变量生产文件
ansible  web -i test_hosts  -m  template -a &quot;src=./test.j2 dest=/tmp/test&quot; -e &quot;var=world&quot;
</code></pre>

<h2>parted模块</h2>
<p>parted模块用来对磁盘进行分区进行操作
|参数|解释|
| --- | --- |
| device | 待操作磁盘设备名称 |
| fs_type | 磁盘分区格式,默认null |
| label | |
| number | 分区号 |
| part_start | 分区开始位置 |
| part_end |  分区结束位置|
| part_type | 分区类型 extended, logical, primary，默认primary|
| state | 状态，present，absent |
| resize | 调整分区大小,默认false |
| unit | 分区默认单位，Choices: s, B, KB, KiB, MB, MiB, GB, GiB, TB, TiB, %, cyl, chs,compact.默认Kib |</p>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 给/dev/vdb磁盘分区
ansible -i test_hosts all -m parted -a &quot;device=/dev/vdb number=1 state=present fs_type=ext4&quot;

# 删除/dev/vdb磁盘分区
ansible -i test_hosts all -m parted -a &quot;device=/dev/vdb number=1 state=absent &quot;
</code></pre>

<h4>lvg模块</h4>
<p>lvg模块，卷组管理，创建、删除卷组以及动态改变卷组大小
|参数|解释|
| --- | --- |
| vg | 要创建的卷组名称 |
| pvs | 要加入到卷组的物理卷列表 |
| pesize | 指定pe大小，默认4M,默认单位M |
| state | 状态，present,absent |</p>
<p>用法:</p>
<pre class="codehilite"><code class="language-bash"># 将物理卷添加到卷组
ansible -i test_hosts all -m lvg -a &quot;vg=centos-01 pvs=/dev/sdb1 state=present&quot;

# 删除卷组
ansible -i test_hosts all -m lvg -a &quot;vg=centos-01 state=absent&quot; 
</code></pre>

<h4>lvol模块</h4>
<p>lvol模块，逻辑卷管理，创建删除逻辑卷</p>
<h4>filesystem模块</h4>
<h4>unarchive模块</h4>
<h4>get_url模块</h4>
<h4>stat模块</h4>
<h4>replace模块</h4>
<h4>lineinfile和blockinfile模块</h4>
<p>lineinfile模块用正则匹配的方式对目标文件的一行内容修改删除，每次只修改一行内容
replace模块可以对目标文件匹配到的多行内容修改删除操作
blockinfile模块对文件进行一次性添加、修改、删除多行内容操作</p>
<p>|参数|解释|
| --- | --- |
| path | 目标文件路径 |
| state | 替换(present)/删除(absent) |
| regexp | 正则匹配,当state=present时，仅最后一个匹配行有效 |
| line | 与state-present同时使用，要插入和修改的内容 |
| create | 文件不存在时是否创建yes/no |</p>
<p>用法：</p>
<pre class="codehilite"><code class="language-bash"># 删除
ansible  web -i test_hosts  -m  lineinfile -a &quot;path=/etc/hosts regexp='^127' state=absent&quot;

# 替换
ansible  web -i test_hosts  -m  lineinfile -a &quot;path=/etc/selinux/config regexp='^SELINUX=' line='SELINUX=disabled' state=present
</code></pre>
        </div>
        
    </div>



                


        </div>

    </div>
    <footer>
        
        <p>&copy; 2024 | 我的博客. 保留所有权利。</p>
    <!--    <p><a href="/privacy">隐私政策</a> | <a href="/terms">使用条款</a></p>-->
        
    </footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
 <!-- 在页面加载完成后启用代码高亮 -->
    <script>
        // 等待页面加载完成后执行高亮
        document.addEventListener('DOMContentLoaded', function() {
            // 启用 highlight.js 代码高亮
            hljs.highlightAll();
        });
    </script>


</html>